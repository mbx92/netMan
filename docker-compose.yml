# NetMan - Docker Compose Production Configuration
# ==============================================================================
# Usage: docker compose --env-file .env.docker up -d --build
# ==============================================================================

services:
  # ============================================================================
  # NetMan Application
  # ============================================================================
  netman-app:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - SSO_BASE_URL=${SSO_BASE_URL:-https://sso.baliroyalhospital.co.id}
        - SSO_CLIENT_ID=${SSO_CLIENT_ID}
        - SSO_CLIENT_SECRET=${SSO_CLIENT_SECRET}
        - SSO_REDIRECT_URI=${SSO_REDIRECT_URI:-https://netman.baliroyalhospital.co.id/auth/callback}
    container_name: netman-app
    restart: unless-stopped
    ports:
      - "${PORT:-3002}:3000"
    environment:
      - NODE_ENV=${NODE_ENV:-production}
      - DATABASE_URL=postgresql://${DB_USER:-postgres}:${DB_PASSWORD:-postgres}@${DB_HOST:-postgres}:${DB_PORT:-5432}/${DB_NAME:-netMan}?schema=public
    env_file:
      - .env.docker
    networks:
      - postgres_default
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s

# ==============================================================================
# Networks - Use existing PostgreSQL network
# ==============================================================================
networks:
  postgres_default:
    external: true
